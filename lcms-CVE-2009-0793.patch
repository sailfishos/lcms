diff -up lcms-1.18/src/cmsxform.c.cve0793 lcms-1.18/src/cmsxform.c
--- lcms-1.18/src/cmsxform.c.cve0793	2009-03-21 16:31:52.000000000 +0100
+++ lcms-1.18/src/cmsxform.c	2009-04-22 01:20:40.000000000 +0200
@@ -660,6 +660,9 @@ LPMATSHAPER cmsBuildGrayOutputMatrixShap
                 GrayTRC = cmsReadICCGamma(hProfile, icSigGrayTRCTag);
                 FromLstarToXYZ(GrayTRC, Shapes1);
 
+		if (GrayTRC == NULL)
+			return NULL;
+
                 // Reversing must be done after curve translation
 
                 Shapes[0] = cmsReverseGamma(Shapes1[0]->nEntries, Shapes1[0]);
@@ -675,6 +678,9 @@ LPMATSHAPER cmsBuildGrayOutputMatrixShap
 
                 GrayTRC = cmsReadICCGammaReversed(hProfile, icSigGrayTRCTag);   // Y
 
+		if (GrayTRC == NULL)
+			return NULL;
+
                 Shapes[0] = cmsDupGamma(GrayTRC);
                 Shapes[1] = cmsDupGamma(GrayTRC);
                 Shapes[2] = cmsDupGamma(GrayTRC); 
